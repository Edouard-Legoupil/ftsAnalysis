<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1-Data Tidying • ftsAnalysis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1-Data Tidying">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ftsAnalysis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-data-tidying.html">1-Data Tidying</a></li>
    <li><a class="dropdown-item" href="../articles/2-indicators.html">2-Indicators</a></li>
    <li><a class="dropdown-item" href="../articles/4-analysis.html">4-Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/5-visualisation.html">5-Visualisation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edouard-legoupil/ftsAnalysis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>1-Data Tidying</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edouard-legoupil/ftsAnalysis/blob/HEAD/vignettes/1-data-tidying.Rmd" class="external-link"><code>vignettes/1-data-tidying.Rmd</code></a></small>
      <div class="d-none name"><code>1-data-tidying.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edouard-legoupil.github.io/ftsAnalysis/" class="external-link">ftsAnalysis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'quantmod':</span></span>
<span><span class="co">#&gt;   method            from</span></span>
<span><span class="co">#&gt;   as.zoo.data.frame zoo</span></span></code></pre></div>
<!-- WARNING - This vignette is generated by {fusen} from dev/flat_dev_1_data.Rmd: do not edit by hand -->
<!-- Run this 'development' chunk -->
<!-- Store every call to library() that you need to explore your functions -->
<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.

If it is the first time you use {fusen}, after 'description', you can directly run the last chunk of the present file with inflate() inside.
-->
<p>FTS focuses on humanitarian funding flows that is provided
internationally. The exception is in-country provision of funds (whether
from private or governmental sources) for projects in an appeal launched
by an international organisation or organisations.</p>
<p>Data does not include:</p>
<ul>
<li>a government’s expenditure on crises within its own borders (except
the in-country provision of funds whether from private or government
sources, for projects in a response plan or appeal launched by an
international organization)</li>
<li>a government’s expenditure on refugees within its own borders</li>
<li>development data (except where funding has been reported for
projects in an inter-agency response plan or appeal)</li>
<li>concessional finance and soft loans</li>
<li>remittances.</li>
</ul>
<div class="section level2">
<h2 id="fetch_fts_data">fetch_fts_data<a class="anchor" aria-label="anchor" href="#fetch_fts_data"></a>
</h2>
<p>Below is a description of the type of variables on <code>flows</code>
data -</p>
<div class="section level3">
<h3 id="identifiers">Identifiers<a class="anchor" aria-label="anchor" href="#identifiers"></a>
</h3>
<ul>
<li><p><code>id</code> the unique identifier for this row, to be used in
the future when there is an update on the same funding for this
row.</p></li>
<li><p><code>versionId</code></p></li>
<li><p><code>childFlowIds</code> The FTS database allows funding flows
to be linked together to represent funding cascading through the
implementation chain from primary donors to field implementers. When
flows are chained together in this way, any flow downstream of the flow
being viewed is referred to as a child flow. All child flows have a
parent flow upstream.</p></li>
<li><p><code>parentFlowId</code> The FTS database allows funding flows
to be linked together to represent funding cascading through the
implementation chain from primary donors to field implementers. When
flows are chained together in this way, any flow upstream of the flow
being viewed is referred to as the parent flow. All parent flows have
one or more child flows downstream.</p></li>
<li>
<p><code>flowType</code> factor with the following levels
“Carryover” “Parked” “Pass through” “Standard”</p>
<ul>
<li><p>A <code>parked</code> flow refers to a funding flow that
initially may not be allocated to specific organizations or sectors, but
for which additional information is forthcoming. ‘Parked’ funding is
usually a parent flow (see glossary for parent flow) with a number of
linked child flows. Parking a parent flow allows the children to reflect
the source information from the linked parent. Parked records are either
major funding decisions (e.g. ECHO decisions that begin as a large
funding envelope without destination organizations) where the
information on recipients is determined at a later time (and added as
child flows), or multi-year funding records where yearly contributions
are broken down as child flows of the ‘parked’ flow.</p></li>
<li><p><code>Pass through</code> funding refers to downstream funding
allocations (e.g. Donor to UN Agency to NGO, Donor to International NGO
to Local NGO, etc.).</p></li>
</ul>
</li>
<li><p><code>refCode</code> a code related to the grant agreement of the
fund, ideally known by the donor and by the recipient
organizations.</p></li>
<li><p><code>reportDetails</code> list of the following variables<br><code>sourceType</code> <code>organization</code>
<code>reportChannel</code> <code>date</code></p></li>
</ul>
</div>
<div class="section level3">
<h3 id="flow-description">Flow Description<a class="anchor" aria-label="anchor" href="#flow-description"></a>
</h3>
<ul>
<li><p><code>description</code> the description briefly; ie. about the
destination activity/project, location within the country, and
duration.</p></li>
<li>
<p><code>grandBargainEarmarkingType</code> modality of earmarking
(Earmarked, Softly earmarked, tightly earmarked, unearmarked) <a href="https://fts.unocha.org/glossary" class="external-link uri">https://fts.unocha.org/glossary</a></p>
<p><strong>Unearmarked</strong></p>
<ul>
<li>A Fully flexible core contribution Financial contribution to the aid
organisation budget, fully flexible (within the boundaries set in
mandates, governing body regulations etc.)<br>
</li>
<li>B Fully flexible core contribution to the CERF Financial
contribution to CERF budget, fully flexible within the CERF
regulations.<br>
</li>
<li>C Core contribution Financial contribution to a significant part of
the aid organisation’s mandate, e.g. restricted to the humanitarian
operations of a double-mandated organisation. The aid organisation can
be instructed to distribute at its discretion – on several strategic
objectives/regions/crises to avoid the entire contribution being used in
one context.</li>
</ul>
<p><strong>Softly earmarked</strong></p>
<ul>
<li>D Core contribution with limitations Financial contribution, but
with exclusions pertaining to a small number of specific countries. The
aid organisation can be instructed to only use funding outside of
certain areas or countries.</li>
<li>E Directed to a geographical region or a strategic objective
Financial contribution, fully flexible within the boundaries of the
strategic objective (e.g. health or education) or region (e.g. Africa).
Should reflect priorities in the Strategic Plan approved by the relevant
governing body.</li>
<li>F Directed to a Country-Based Pooled Fund Financial contribution
directed to a specific Country-Based Pooled Fund, otherwise fully
flexible.</li>
</ul>
<p><strong>Earmarked</strong></p>
<ul>
<li>G Directed to an aid organiastion’s country operations Financial
contribution, directed to a specific country, otherwise fully flexible.
Should reflect priorities set by the relevant governing body regarding
country operations.</li>
<li>H Directed to subobjective/target Financial contribution, directed
to subcategories of strategic objectives, e.g. health/malaria or
education /teacher training, but without geographical limitations.
Should reflect priorities in the Strategic Plan approved by the relevant
governing body.</li>
</ul>
<p><strong>Tightly earmarked</strong></p>
<ul>
<li>I Directed to a specific project Financial contribution directed to
a specific project in a specific country.<br>
</li>
<li>J Directed geographically and thematically, tied financial Financial
contribution, tied to certain conditions in terms of purchase
restrictions, directed to a specific country/region and to a specific
objective. For instance, financial contribution for purchase of ABC for
school feeding in X-land.<br>
</li>
<li>K Directed geographically and thematically, in kind. In-kind
contribution directed to a specific country/region and to a specific
objective. For instance, rice for school feeding in X-land.<br>
</li>
<li>L Donor-initiated projects/directed contributions Financial
contribution coupled with the demand for a specific project in a
specific country fulfilling donor priorities. Not reflecting Strategic
Plan of the aid organisation. For instance, it becomes a service
provider. This will also put strain on non-project support costs
(overhead costs).</li>
</ul>
</li>
<li><p><code>contributionType</code> - (financial, in-kind)</p></li>
<li>
<p><code>Reporting Status</code> indicate the status of the
humanitarian fund reported per each row (“New Contribution”,
“Top-up/Update”, “Old Contribution”)</p>
<ul>
<li><pre><code>  New contribution (aka New money): The fund is being reported to FTS by the same reporter for the first time. </code></pre></li>
<li><pre><code> Top-up/update: The fund was reported to FTS by the same reporter and now there is an update on the amount and/or on any other details.</code></pre></li>
<li><pre><code> Old contribution: The fund was reported to FTS by the same reporter and there is no change. Used when reporters share cumulative reports.</code></pre></li>
</ul>
</li>
<li><p><code>newMoney</code> FALSE/TRUE</p></li>
<li><p><code>keywords</code></p></li>
<li><p><code>method</code> Cash Transfer Programming (CTP) refers to all
programs where cash (or vouchers for goods or services) is directly
provided to beneficiaries.The CTP can be of three types: cash, mobile
phone transfer and vouchers. FTS refers to all other humanitarian
assistance modalities as traditional aid. Traditional: Non-cash
assistance provided in the form of materials or services (i.e. food,
tents, PSS, secondment of staff).</p></li>
<li><p><code>boundary</code> Boundaries classify relevant flows into the
categories incoming, internal and outgoing. The FTS database records
flows of funding, and draws boundaries around (combinations of) flow
properties to calculate totals. Examples of common boundaries are a
response plan/appeal or a combination of a (donor or affected) country
and a year. Drawing a boundary classifies the flows in the database into
those crossing the boundary inward (incoming flows), those originating
and terminating within the boundary (internal flows), those crossing it
outwards (outgoing flows), and a fourth category that is not displayed -
those that are irrelevant to the boundary because they originate and
terminate outside of it. Incoming flows are flows which cross a given
search boundary inwards. If the boundary is e.g. an affected country and
year, flows originating in donor countries or multilateral organisations
attributed to the country are incoming flows, as is carry-over from a
previous year. To avoid double-counting, incoming flows should never be
added to internal flows. Outgoing flows are flows which originate within
and terminate outside a given search boundary. If the boundary is
e.g. an affected country and year, flows representing carry-overs to the
next year are outgoing flows.</p></li>
<li><p><code>onBoundary</code></p></li>
<li>
<p><code>status</code> The status of humanitarian funding reported.
(pledge, commitment, paid)</p>
<ul>
<li><p>“commitment” is for a binding agreement signed between parties OR
for approval of a grant by the donor member state. Creation of a
contractual obligation regarding funding between the donor and appealing
agency; almost always takes the form of a signed contract. This is the
crucial stage of humanitarian funding: agencies cannot spend money and
implement before a funding commitment is made.</p></li>
<li><p>“pledge” is for no binding agreement OR no official government
approval.A non-binding announcement of an intended contribution or
allocation by the donor. The recipient organization and response plan or
project are not necessarily specified. As soon as a commitment is
reported to FTS against a pledge, the amount in the pledge column is
reduced accordingly. FTS tables therefore show the ‘outstanding’ (not
‘total original’) pledge amount. The information is reported to us
directly by donors and agencies and may or may not include verbal
commitments made at pledging conferences.</p></li>
<li><p>“paid” is for the money transfer realized. FTS does not track
disbursements / installments</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="quantity">Quantity<a class="anchor" aria-label="anchor" href="#quantity"></a>
</h3>
<ul>
<li>
<code>amountUSD</code> Total Amount in US$</li>
<li><code>fullParkedAmountUSD</code></li>
<li><code>originalAmount</code></li>
<li>
<code>originalCurrency</code> Original Currency The currency of the
humanitarian fund reported.</li>
<li>
<code>exchangeRate</code> If blank, FTS will use the UN Operational
Exchange Rate (<a href="https://treasury.un.org/operationalrates/OperationalRates.php" class="external-link uri">https://treasury.un.org/operationalrates/OperationalRates.php</a>),
as of the grant decision date</li>
</ul>
</div>
<div class="section level3">
<h3 id="date">Date<a class="anchor" aria-label="anchor" href="#date"></a>
</h3>
<ul>
<li>
<code>budgetYear</code> Indicate the year in which the funding will
be used. FTS works in calendar year system (from January to December for
each year)</li>
<li>
<code>date</code> Date when submited to FTS</li>
<li>
<code>decisionDate</code> Date of the grant agreement that was
signed between the recipient organization and the donor organization. OR
date of the official endorsement by the donor member state</li>
<li><code>firstReportedDate</code></li>
<li><code>createdAt</code></li>
<li><code>updatedAt</code></li>
</ul>
</div>
<div class="section level3">
<h3 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a>
</h3>
<p><code>sourceObjects</code> is a list variable including:<br>
* <code>id"                    *</code>name”<br>
* <code>type</code> that can take the following values:<br>
* “Organization”Source Organisation * “Location” Location of source
organisation *“UsageYear” Indicate the year from which the donor plans
to allocate funding</p>
</div>
<div class="section level3">
<h3 id="destination">Destination<a class="anchor" aria-label="anchor" href="#destination"></a>
</h3>
<p><code>destinationObjects</code> is a list variable including:<br>
* <code>id"                    *</code>name”<br>
* <code>type</code> that can take the following values: * “Cluster”
Global Sector refers to a discrete technical area of humanitarian
action, whereas field cluster is technical area in a specific
coordinated plan. List of Global Sectors can be found here: <a href="https://fts.unocha.org/global-sectors/summary/2025" class="external-link uri">https://fts.unocha.org/global-sectors/summary/2025</a>. *
“GlobalCluster” Global Sector refers to a discrete technical area of
humanitarian action, whereas field cluster is technical area in a
specific coordinated plan. List of Global Sectors can be found here: <a href="https://fts.unocha.org/global-sectors/summary/2025" class="external-link uri">https://fts.unocha.org/global-sectors/summary/2025</a>. *
“Location” The location where the emergency is being addressed by the
humanitarian funding reported * “Plan” Destination Plan/Appeal Name =
left blank for funding outside plan. Refer to the Coordinated Plans Page
on FTS website<br>
* “UsageYear” * “Organization”Recipient Organisation * “behavior” used
if two records are of the same type - signal breakdown “single” or
“shared” if type==“Organization” - then the following additional
variables are available<br>
* <code>organizationTypes</code><br>
* <code>organizationSubTypes</code> *
<code>organizationLevels</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flows &lt;- fetch_fts_data(year = 2025)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># names(flows)</span></span>
<span><span class="co"># dplyr::glimpse(flows)</span></span>
<span><span class="co"># nrow(flows)</span></span>
<span><span class="co"># head(flows,1)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #sinew::makeOxygen(flows, add_fields = "source")</span></span>
<span><span class="co"># ## Saving it in the package to avoid constnat API Call</span></span>
<span><span class="co"># save(flows, file =  here::here("data","flows.RData"))</span></span>
<span><span class="co"># # Note: significantly better compression could be obtained</span></span>
<span><span class="co"># #by using R CMD build --resave-data</span></span>
<span><span class="co"># tools::resaveRdaFiles(here::here("data","flows.RData"),compress="bzip2")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="filter_flows_for_indicators">filter_flows_for_indicators<a class="anchor" aria-label="anchor" href="#filter_flows_for_indicators"></a>
</h2>
<p>When analyzing funding flow data from FTS (Financial Tracking
Service), we need to apply pre-processing and filtering rules to compute
donor-, recipient-, or destination-level indicators .</p>
<p>The FTS data model contains several elements—such as funding chains,
boundaries, parent/child flows, and “parked” envelopes—that must be
normalized prior to any aggregation. This enforces the official FTS
logic to ensure indicators are computed without double-counting or
misclassification of funding flows.</p>
<p><strong>1. Boundary Filtering</strong> Only __incoming__flows are
retained. Incoming flows represent funding entering a boundary (e.g.,
affected country + year, appeal, donor-country-year). This is the
standard FTS method for calculating donor contributions, and prevents
contamination from:</p>
<ul>
<li>Internal flows (money moving within the boundary)</li>
<li>Outgoing flows (money leaving the boundary)</li>
<li>Irrelevant flows (fully outside the boundary)</li>
</ul>
<p>Boundary filtering ensures that only flows relevant to the selected
analytical scope enter the indicator dataset.</p>
<p><strong>2. Parent/Child Flow Deduplication</strong> FTS allows
funding flows to be “chained” to represent cascading funding (donor
-&gt; agency -&gt; partner). Parent flows are typically high-level
envelopes; child flows represent operational allocations.</p>
<p>We need to: * Identifies parents by the presence of one or more
<code>childFlowIds</code>. * Removes all parent flows from the
dataset.</p>
<p>This prevents double-counting parent envelopes together with their
child breakdowns and ensures only operational flows are used in
indicator calculations.</p>
<p><strong>3. Removal of “Parked” Flows</strong> Flows with
<code>flowType == "Parked"</code> represent undecided envelopes awaiting
breakdown into child flows (e.g., large ECHO decisions or multi-year
envelopes).</p>
<p>These should not be used for: * donor funding totals *
donor–recipient relationships * sector or geographic alignment
indicators</p>
<p>We need to remove them entirely, relying instead on their child flows
when available.</p>
<p><strong>4. Budget Year Normalization</strong></p>
<p>The <code>budgetYear</code> column is converted safely to numeric to
support time-series indicators such as: * funding trends * relationship
duration * consistency indices</p>
<p>Non-numeric and malformed values are converted to <code>NA</code>
with warnings suppressed.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 22441</span></span>
<span><span class="va">cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_flows_for_indicators.html">filter_flows_for_indicators</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cleaned</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 11496</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="slugify">slugify<a class="anchor" aria-label="anchor" href="#slugify"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Café au Lait"</span>, <span class="st">"Niño Español"</span>, <span class="st">"Data_Science_Project"</span>, <span class="st">"--test--string--"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/slugify.html">slugify</a></span><span class="op">(</span><span class="va">strings</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "cafe-au-lait"         "nino-espanol"         "data-science-project"</span></span>
<span><span class="co">#&gt; [4] "test-string"</span></span></code></pre></div>
<!--
# There can be development actions

Create a chunk with 'development' actions

- The chunk needs to be named `development` or `dev`
- It contains functions that are used for package development only
- Note that you may want to store most of these functions in the 0-dev_history.Rmd file

These are only included in the present flat template file, their content will not be part of the package anywhere else.
-->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edouard Legoupil.</p>
</div>

<div class="pkgdown-footer-right">
  <p><a href="https://www.unhcr.org/" target="_blank" rel="noopener noreferrer" class="external-link"><img src="https://raw.githubusercontent.com/unhcr-dataviz/unhcrtemplate/master/man/figures/logo.svg" alt="UNHCR logo" style="max-height:2.5rem"></a></p>
</div>

    </footer>
</div>





  </body>
</html>
