<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4-Analysis • ftsAnalysis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4-Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ftsAnalysis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-data-tidying.html">1-Data Tidying</a></li>
    <li><a class="dropdown-item" href="../articles/2-indicators.html">2-Indicators</a></li>
    <li><a class="dropdown-item" href="../articles/4-analysis.html">4-Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/5-visualisation.html">5-Visualisation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edouard-legoupil/ftsAnalysis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="4-analysis_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="4-analysis_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="4-analysis_files/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet">
<script src="4-analysis_files/wordcloud2-0.0.1/wordcloud2-all.js"></script><script src="4-analysis_files/wordcloud2-0.0.1/hover.js"></script><script src="4-analysis_files/wordcloud2-binding-0.2.1/wordcloud2.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4-Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edouard-legoupil/ftsAnalysis/blob/HEAD/vignettes/4-analysis.Rmd" class="external-link"><code>vignettes/4-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>4-analysis.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edouard-legoupil.github.io/ftsAnalysis/" class="external-link">ftsAnalysis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'quantmod':</span></span>
<span><span class="co">#&gt;   method            from</span></span>
<span><span class="co">#&gt;   as.zoo.data.frame zoo</span></span></code></pre></div>
<!-- WARNING - This vignette is generated by {fusen} from dev/flat_dev_4_analysis.Rmd: do not edit by hand -->
<!-- Run this 'development' chunk -->
<!-- Store every call to library() that you need to explore your functions -->
<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.

If it is the first time you use {fusen}, after 'description', you can directly run the last chunk of the present file with inflate() inside.
-->
<div class="section level2">
<h2 id="analysis_wordcloud_from_flows">analysis_wordcloud_from_flows<a class="anchor" aria-label="anchor" href="#analysis_wordcloud_from_flows"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/analysis_wordcloud_from_flows.html">analysis_wordcloud_from_flows</a></span><span class="op">(</span><span class="va">flows</span>, facet_by_year <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:90%;height:474.624px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"word":["emergency","protection","conflict","assistance","health","vulnerable","services","populations","displacement","food","communities","integrated","lifesaving","affected","needs","nutrition","réponse","education","wash","refugees","first","access","sudan","multisectoral","provision","security","action","children","disaster","crisis","areas","people","women","rapid","violence","contribution","conflictaffected","host","climate","resilience","south","strengthening","ukraine","displaced","natural","shelter","multisectorielle","emergencies","crises","syria","local","besoins","yemen","population","idps","affectées","refugee","gbv","regional","republic","afghanistan","water","cash","enhancing","fund","child","violenceclashes","cerf","gaza","drought","returnees","coordination","communautés","providing","girls","state","community","multisector","inclusive","preparedness","risk","safe","livelihoods","north","central","santé","crise","ocha","venezuela","africa","families","congo","nigeria","province","lebanon","somalia","hôtes","improving","quality","west"],"freq":[6807,4722,4286,3723,3003,2612,2523,2517,2456,2389,2306,2148,2086,2024,1823,1780,1593,1446,1364,1340,1329,1309,1301,1253,1232,1209,1165,1155,1154,1124,1025,1025,994,977,957,955,951,947,916,896,875,843,824,797,789,742,738,718,712,708,705,699,692,688,674,661,655,651,646,646,645,633,623,622,606,600,597,592,586,575,557,548,543,540,526,523,520,514,512,512,511,510,506,504,494,485,479,473,456,453,451,447,447,445,441,440,437,436,436,431],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":0.01851035698545615,"backgroundColor":"white","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.5,"shape":"circle","ellipticity":0.8,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Returns a named list of word cloud objects</span></span>
<span><span class="va">yearly_clouds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_wordcloud_from_flows.html">analysis_wordcloud_from_flows</a></span><span class="op">(</span><span class="va">flows</span>, facet_by_year <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in max(dataOut$freq): no non-missing arguments to max; returning -Inf</span></span>
<span><span class="co">#&gt; Warning in max(dataOut$freq): no non-missing arguments to max; returning -Inf</span></span>
<span><span class="co">#&gt; Warning in max(dataOut$freq): no non-missing arguments to max; returning -Inf</span></span>
<span><span class="co">#&gt; Warning in max(dataOut$freq): no non-missing arguments to max; returning -Inf</span></span>
<span><span class="co">#&gt; Warning in max(dataOut$freq): no non-missing arguments to max; returning -Inf</span></span>
<span></span>
<span><span class="co"># To view the cloud for a specific year  </span></span>
<span><span class="va">yearly_clouds</span><span class="op">[[</span><span class="st">"2015"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:90%;height:474.624px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"word":[],"freq":[],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":-0,"backgroundColor":"white","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.5,"shape":"circle","ellipticity":0.8,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_clouds</span><span class="op">[[</span><span class="st">"2024"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:90%;height:474.624px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"word":["protection","assistance","emergency","health","populations","vulnerable","services","affected","communities","integrated","réponse","lifesaving","conflict","needs","education","food","refugees","nutrition","access","crisis","sudan","people","multisectoral","children","strengthening","violence","host","provision","action","wash","displaced","afghanistan","security","resilience","disaster","ukraine","population","crises","south","areas","rapid","affectées","preparedness","refugee","conflictaffected","central","syria","multisector","colombia","contribution","local","regional","republic","cash","enhancing","women","coordination","improving","basic","management","crise","yemen","comprehensive","mozambique","child","displacement","providing","community","inclusive","supporting","emergencies","vulnérables","idps","mali","shelter","province","urgence","appeal","besoins","crisisaffected","programme","multisectorielle","nord","returnees","venezuela","intégrée","nigeria","climate","ethiopia","north","development","safe","girls","quality","somalia","déplacées","households","sexual","africa","based"],"freq":[973,770,655,590,561,537,521,475,440,393,328,306,293,293,284,281,280,278,265,252,247,243,240,230,221,218,215,215,214,208,188,177,175,173,170,167,165,163,161,160,159,157,156,156,149,146,146,143,140,140,140,137,135,131,131,131,127,121,119,117,116,116,112,112,110,110,109,108,106,106,105,103,101,101,100,98,98,95,95,93,93,92,92,92,91,89,88,87,87,87,86,86,85,84,83,82,80,79,78,78],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":0.1294964028776978,"backgroundColor":"white","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.5,"shape":"circle","ellipticity":0.8,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_clouds</span><span class="op">[[</span><span class="st">"2025"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:90%;height:474.624px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"word":["emergency","conflict","protection","assistance","displacement","health","vulnerable","populations","food","services","lifesaving","integrated","communities","nutrition","needs","first","affected","réponse","wash","multisectoral","provision","disaster","sudan","education","refugees","access","rapid","security","children","climate","areas","conflictaffected","natural","crisis","contribution","people","multisectorielle","south","violenceclashes","besoins","action","emergencies","host","shelter","resilience","idps","cerf","strengthening","drought","affectées","displaced","syria","ukraine","republic","yemen","water","communautés","violence","gaza","returnees","fund","postconflict","cash","regional","enhancing","cholera","population","refugee","afghanistan","child","congo","santé","women","hôtes","gbv","state","north","crise","coordination","providing","safe","provinces","underfunded","risk","province","urgence","ocha","crises","nigeria","flood","inclusive","vulnérables","central","families","west","africa","hygiene","venezuela","somalia","darfur"],"freq":[5826,3829,3145,2585,2249,1833,1757,1732,1698,1638,1622,1536,1462,1362,1354,1311,1222,1206,1014,952,901,884,872,869,865,818,787,781,750,734,712,701,696,670,668,664,631,604,597,593,583,570,555,542,526,515,504,483,479,476,474,472,466,464,462,457,454,448,436,430,420,420,411,407,406,404,400,399,391,391,379,379,371,369,364,358,354,348,346,346,337,333,326,324,318,312,311,308,307,306,301,300,299,298,298,297,296,295,294,289],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":0.02162718846549948,"backgroundColor":"white","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.5,"shape":"circle","ellipticity":0.8,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
<div class="section level2">
<h2 id="analysis_systemic_network_insights">analysis_systemic_network_insights<a class="anchor" aria-label="anchor" href="#analysis_systemic_network_insights"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">network_insights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_systemic_network_insights.html">analysis_systemic_network_insights</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span></span>
<span></span>
<span><span class="va">density_trend_data</span> <span class="op">&lt;-</span> <span class="va">network_insights</span><span class="op">$</span><span class="va">Density_Trend</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">network_insights</span><span class="op">$</span><span class="va">Density_Trend</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">Density_by_Year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#4361EE"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#4361EE"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>, </span>
<span>                              limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">network_insights</span><span class="op">$</span><span class="va">Density_Trend</span><span class="op">$</span><span class="va">Density_by_Year</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">network_insights</span><span class="op">$</span><span class="va">Density_Trend</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Evolution of Funding Network Connectivity (Donor-Recipient Density)"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Tracking the percentage of possible donor-recipient links that </span></span>
<span><span class="st">    were actually funded each year."</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Network Density (%)"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Indicator interpretation:"</span>,</span>
<span>    <span class="st">"This visualization tracks the **Network Density** of the funding ecosystem</span></span>
<span><span class="st">    over time. Density is a measure of **connectivity**: it represents the</span></span>
<span><span class="st">    percentage of all theoretically possible unique donor-to-recipient</span></span>
<span><span class="st">    relationships that actually received funding in a given year. </span></span>
<span><span class="st">    The dashed line shows the long-term trend."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    </span>
<span>    <span class="st">"An **increasing density trend** suggests the ecosystem is becoming more</span></span>
<span><span class="st">    distributed and interconnected, which may reduce risk reliance on a few key</span></span>
<span><span class="st">    links. A **decreasing density trend** suggests the network is retracting or</span></span>
<span><span class="st">    consolidating. </span></span>
<span><span class="st">    This helps us assess the maturity and fragmentation of the funding system."</span>, </span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    </span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span></span>
<span>    grid <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>    axis <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    axis_title <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_systemic_network_insights-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_portfolio_scores">analysis_portfolio_scores<a class="anchor" aria-label="anchor" href="#analysis_portfolio_scores"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_portfolio_scores.html">analysis_portfolio_scores</a></span><span class="op">(</span><span class="va">flows</span>, </span>
<span>               recipient_name<span class="op">=</span><span class="st">"United Nations High Commissioner for Refugees"</span>, </span>
<span>                          top_n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">scores</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">donor</span>, <span class="va">Portfolio_Score</span><span class="op">)</span>, </span>
<span>                                     y <span class="op">=</span> <span class="va">Portfolio_Score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Portfolio_Score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Donor Portfolio Scores for UNHCR"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Measure of the combined quality, consistency, and strategic </span></span>
<span><span class="st">       alignment of a donor's funding relationship"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Donor"</span>, y <span class="op">=</span> <span class="st">"Portfolio Score"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"Indicator interpretation:"</span>,</span>
<span>    <span class="st">"The **Portfolio Score**  is calculated as: **Donor Engagement** $\\times$ </span></span>
<span><span class="st">    **Funding Amount** $\\times$ (1 - **Donor Concentration Risk**) $\\times$ </span></span>
<span><span class="st">    **Strategic Alignment**. A higher score indicates a more valuable and </span></span>
<span><span class="st">    reliable funding partner for the recipient."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    </span>
<span>    <span class="st">" The total bar </span></span>
<span><span class="st">    length represents the Portfolio Score, which is driven by four components: </span></span>
<span><span class="st">    **Donor Engagement** (consistency of giving over time), **Funding Amount** </span></span>
<span><span class="st">    (total USD provided), **Donor Concentration Risk** (inverse of funding </span></span>
<span><span class="st">    diversification across all destinations), and **Strategic Alignment** </span></span>
<span><span class="st">    (share of donor funding aligned with the recipient's primary Global </span></span>
<span><span class="st">    Clusters)."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    </span>
<span>    <span class="st">"Humanitarian relevance:"</span>,</span>
<span>    <span class="st">"Identifies key and potentially most reliable donors whose funding </span></span>
<span><span class="st">    relationship is both substantial and strategically aligned with the</span></span>
<span><span class="st">    recipient's mandate. It helps the recipient organization prioritize </span></span>
<span><span class="st">    relationship management and provides donors with a metric to assess the</span></span>
<span><span class="st">    quality of their long-term partnerships."</span>, </span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>      labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="st">"X"</span>, axis <span class="op">=</span>  <span class="st">"Y"</span>, axis_title <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_portfolio_scores-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_prepare_opportunity_dataset">analysis_prepare_opportunity_dataset<a class="anchor" aria-label="anchor" href="#analysis_prepare_opportunity_dataset"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crisis_keywords</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"refugees"</span>, <span class="st">"refugee"</span>,<span class="st">"displacement"</span>, <span class="st">"displaced"</span>,</span>
<span>                         <span class="st">"returnees"</span>,<span class="st">"idps"</span>,</span>
<span>                        <span class="st">"protection"</span>, <span class="st">"conflict"</span>, <span class="st">"vulnerable"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_prepare_opportunity_dataset.html">analysis_prepare_opportunity_dataset</a></span><span class="op">(</span> <span class="va">flows</span>,</span>
<span>    lookback_years <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    crisis_keywords <span class="op">=</span> <span class="va">crisis_keywords</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `dplyr::summarise()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `max_cluster_share = max(cluster_share, na.rm = TRUE)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 347: `donor = "European Commission's Humanitarian Aid and Civil</span></span>
<span><span class="co">#&gt;   Protection Department"`, `recipient = "Emergency Shelter and NFI"`, `year =</span></span>
<span><span class="co">#&gt;   2021`.</span></span>
<span><span class="co">#&gt; Caused by warning in `max()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> no non-missing arguments to max; returning -Inf</span></span>
<span></span>
<span><span class="co"># Filter for non-NA growth, arrange by descending growth, and take the top 5.</span></span>
<span><span class="va">label_data_top</span> <span class="op">&lt;-</span> <span class="va">features</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pct_growth</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">pct_growth</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>donor_wrapped <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">donor</span>, <span class="st">" --&gt; "</span>,</span>
<span>                                                  <span class="va">recipient</span><span class="op">)</span>,</span>
<span>                                           width <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">features</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_amount</span>, y <span class="op">=</span> <span class="va">pct_growth</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>  data <span class="op">=</span> <span class="va">label_data_top</span>, </span>
<span>                             <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">donor_wrapped</span><span class="op">)</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">2.5</span>, segment.color <span class="op">=</span> <span class="st">'grey50'</span>, </span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span>, box.padding <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span></span>
<span>      labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Funding Opportunity Analysis: Amount vs. Growth"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"Focusing on the following keywords within project description: "</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">crisis_keywords</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Total Amount (log scale)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Percentage Growth"</span>,</span>
<span>    caption<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Indicator interpretation: Points in the top-right quadrant indicate </span></span>
<span><span class="st">      high-value future opportunities."</span>, <span class="st">"\n\n"</span>,</span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="cn">TRUE</span>, axis <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                           axis_title <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; Warning in ggplot2::scale_x_log10(labels = scales::label_number(scale_cut =</span></span>
<span><span class="co">#&gt; scales::cut_short_scale())): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 6559 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_prepare_opportunity_dataset-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_fit_opportunity_model">analysis_fit_opportunity_model<a class="anchor" aria-label="anchor" href="#analysis_fit_opportunity_model"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_prepare_opportunity_dataset.html">analysis_prepare_opportunity_dataset</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `dplyr::summarise()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `max_cluster_share = max(cluster_share, na.rm = TRUE)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 347: `donor = "European Commission's Humanitarian Aid and Civil</span></span>
<span><span class="co">#&gt;   Protection Department"`, `recipient = "Emergency Shelter and NFI"`, `year =</span></span>
<span><span class="co">#&gt;   2021`.</span></span>
<span><span class="co">#&gt; Caused by warning in `max()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> no non-missing arguments to max; returning -Inf</span></span>
<span><span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_fit_opportunity_model.html">analysis_fit_opportunity_model</a></span><span class="op">(</span><span class="va">features</span>, min_year <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">model_results</span><span class="op">$</span><span class="va">train</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model_results</span><span class="op">$</span><span class="va">model</span></span>
<span><span class="va">train_data</span><span class="op">$</span><span class="va">predicted_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">train_data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">train_data</span>, </span>
<span>                <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predicted_prob</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">opportunity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>      labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>      labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Ability to forecast potential funding streams based on previous years"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Comparing the probability score assigned by the model against the</span></span>
<span><span class="st">    actual outcome \n (Funding Occurred = 1, No Funding = 0)."</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Actual Opportunity"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"The X-axis shows the **Predicted Probability**</span></span>
<span><span class="st">    (a score from 0 to 1) that a donor will fund a recipient in the next year. </span></span>
<span><span class="st">    The two colored curves show the distribution of this score based on the </span></span>
<span><span class="st">    **Actual Outcome** for that relationship-year observation:  **Blue Curve</span></span>
<span><span class="st">    (0: No Funding):** Represents relationships where the donor *did not* fund</span></span>
<span><span class="st">    the recipient next year. Most of these probabilities should cluster near 0.</span></span>
<span><span class="st">    **Red Curve (1: Funding Occurred):** Represents relationships where </span></span>
<span><span class="st">    the donor *did* fund the recipient next year. </span></span>
<span><span class="st">    Most of these probabilities should cluster near 1."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="cn">TRUE</span>, axis <span class="op">=</span>  <span class="cn">TRUE</span>, axis_title <span class="op">=</span> <span class="cn">TRUE</span>, legend<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_fit_opportunity_model-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_competitive_intel_matrix">analysis_competitive_intel_matrix<a class="anchor" aria-label="anchor" href="#analysis_competitive_intel_matrix"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recipient_name</span> <span class="op">&lt;-</span> <span class="st">"United Nations High Commissioner for Refugees"</span></span>
<span></span>
<span><span class="va">matrix_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_competitive_intel_matrix.html">analysis_competitive_intel_matrix</a></span><span class="op">(</span><span class="va">flows</span>,</span>
<span>                                              <span class="va">recipient_name</span>,</span>
<span>                                              peers <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">matrix_data</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">market_share</span>, </span>
<span>                                          y <span class="op">=</span> <span class="va">growth_differential</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">our_funding</span>, color <span class="op">=</span> <span class="va">sector</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">sector</span><span class="op">)</span>,</span>
<span>            vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span></span>
<span>    scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span></span>
<span>    scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Competitive Intelligence Matrix"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Market Share"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Growth Differential"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Our Funding"</span>,</span>
<span>    caption <span class="op">=</span><span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span></span>
<span>    grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    axis <span class="op">=</span>  <span class="cn">FALSE</span>,</span>
<span>    axis_title <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>  </span>
<span><span class="co">#&gt; Warning: Removed 21 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 21 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_text()`).</span></span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_competitive_intel_matrix-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_donor_lifecycle_stage">analysis_donor_lifecycle_stage<a class="anchor" aria-label="anchor" href="#analysis_donor_lifecycle_stage"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recipient_name</span> <span class="op">&lt;-</span> <span class="st">"United Nations High Commissioner for Refugees"</span></span>
<span><span class="va">stages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_donor_lifecycle_stage.html">analysis_donor_lifecycle_stage</a></span><span class="op">(</span><span class="va">flows</span>, recipient_name<span class="op">=</span> <span class="va">recipient_name</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">stages</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">stage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Donor Lifecycle Stages for "</span>, <span class="va">recipient_name</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Based on their historical funding behavior, complexity </span></span>
<span><span class="st">       of partnership, and alignment"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of Donors"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"Indicator interpretation:"</span>,</span>
<span>    <span class="st">"This visualization segments donors into specific **Lifecycle Stages** . </span></span>
<span><span class="st">    This framework helps tailor engagement strategies to maximize potential </span></span>
<span><span class="st">    and retention. The stages represent a progression in the relationship </span></span>
<span><span class="st">    quality and maturity: "</span>, </span>
<span>    <span class="st">"**Prospect:** High potential alignment, but hasn't provided funding yet </span></span>
<span><span class="st">    (highest priority for first outreach). "</span>, </span>
<span>    <span class="st">" **New Partner:** Recently started funding (1-2 years), establishing the </span></span>
<span><span class="st">    relationship."</span>,</span>
<span>    <span class="st">" **Growing Partner:** Demonstrates increasing funding trends and engages </span></span>
<span><span class="st">    across multiple sectors (focus on deepening the partnership). "</span>,</span>
<span>    <span class="st">"**Strategic Partner:** Provides multi-year or flexible funding and shows</span></span>
<span><span class="st">    high strategic alignment (focus on co-design and long-term goals). "</span>,</span>
<span>    <span class="st">"**Legacy Partner:** Long-term partners (10+ years of funding), </span></span>
<span><span class="st">    foundational to our operations. "</span>,</span>
<span>    <span class="st">"**Maintenance:** Donors that do not fit the criteria for active </span></span>
<span><span class="st">    growth stages (focus on efficient retention)."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    </span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API Data."</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="st">"X"</span>, axis <span class="op">=</span> <span class="st">"Y"</span>, axis_title <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                           legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>   </span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_donor_lifecycle_stage-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_donor_segmentation">analysis_donor_segmentation<a class="anchor" aria-label="anchor" href="#analysis_donor_segmentation"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recipient_name</span> <span class="op">&lt;-</span>  <span class="st">"United Nations High Commissioner for Refugees"</span></span>
<span><span class="va">segments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_donor_segmentation.html">analysis_donor_segmentation</a></span><span class="op">(</span><span class="va">flows</span>, <span class="va">recipient_name</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_data_top_donors</span> <span class="op">&lt;-</span> <span class="va">segments</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>donor <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span><span class="va">donor</span>,</span>
<span>                                           width <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">segments</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strategic_Priority</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">Resource_Allocation_Score</span>, </span>
<span>                     color <span class="op">=</span> <span class="va">segment</span>,</span>
<span>                     size <span class="op">=</span> <span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">label_data_top_donors</span>,</span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">donor</span><span class="op">)</span>,  </span>
<span>    size <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>    segment.color <span class="op">=</span> <span class="st">'grey50'</span>,</span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    box.padding <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    max.overlaps <span class="op">=</span> <span class="cn">Inf</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span></span>
<span>    scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span></span>
<span>    scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n.breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span></span>
<span>    scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Donor Segmentation for "</span>,  <span class="va">recipient_name</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Combined value of the relationship based on </span></span>
<span><span class="st">       **Donor Engagement**, **Alignment Index**, and **Growth Potential** in </span></span>
<span><span class="st">       relation with funding history"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Strategic Priority"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Resource Allocation Score"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Segment"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Indicator interpretation:"</span>,</span>
<span>    <span class="st">"For **Strategic Priority (X-axis):** Higher means a more valuable or </span></span>
<span><span class="st">    promising relationship."</span>,</span>
<span>    <span class="st">"The **Resource Allocation Score (Y-axis):** is an indicator of whether the</span></span>
<span><span class="st">    donor is 'under-resourced'. It is calculated as Strategic Priority divided</span></span>
<span><span class="st">    by the total historical funding (total). Higher scores suggest the donor has</span></span>
<span><span class="st">    high priority but currently receives relatively low engagement effort."</span>,</span>
<span>    <span class="st">"The size of the bubble reflects the **Total Funding Amount** to all </span></span>
<span><span class="st">    destinations, showing the donor's overall financial capacity."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    <span class="st">"Each bubble represents a donor, classified into a segment based on its </span></span>
<span><span class="st">    position on the matrix."</span>,</span>
<span>    <span class="st">"This **Donor Segmentation Matrix** classifies donors into five categories</span></span>
<span><span class="st">    based on two calculated scores:"</span>,</span>
<span>    <span class="st">"1. **Strategic Stars (Top-Right, High Y):** High Strategic Priority, but </span></span>
<span><span class="st">    currently under-resourced by our organization (high potential for increased</span></span>
<span><span class="st">    funding/engagement)."</span>,</span>
<span>    <span class="st">"2. **Core Partners (Right, Lower Y):** High Strategic Priority and already</span></span>
<span><span class="st">    well-resourced (maintain stable, high-value relationship)."</span>,</span>
<span>    <span class="st">"3. **Emerging Opportunities (Middle):** Medium Strategic Priority and good</span></span>
<span><span class="st">    growth potential (focus on growth)."</span>,</span>
<span>    <span class="st">"4. **Divestment Candidates (Bottom-Left):** Low Strategic Priority </span></span>
<span><span class="st">    (low returns on effort)."</span>,</span>
<span>    <span class="st">"5. **Maintenance Accounts (Bottom-Right, High Total):** Lower Strategic </span></span>
<span><span class="st">    Priority, but historically large and stable contributors (focus on stable</span></span>
<span><span class="st">    retention and minimizing effort)."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="cn">TRUE</span>, axis <span class="op">=</span>  <span class="cn">FALSE</span>, axis_title <span class="op">=</span> <span class="cn">TRUE</span>, legend<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_donor_segmentation-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_funding_forecast">analysis_funding_forecast<a class="anchor" aria-label="anchor" href="#analysis_funding_forecast"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">donor</span> <span class="op">&lt;-</span> <span class="st">"Germany"</span></span>
<span><span class="va">forecast_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_funding_forecast.html">analysis_funding_forecast</a></span><span class="op">(</span><span class="va">flows</span>,</span>
<span>                                             by <span class="op">=</span> <span class="st">"donor"</span>, </span>
<span>                                             name <span class="op">=</span> <span class="va">donor</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">$</span><span class="va">forecast</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span></span>
<span>    scale_cut <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Funding Forecast of monthly funding amounts from "</span>,</span>
<span>  <span class="va">donor</span><span class="op">)</span>,</span>
<span>       subtitle<span class="op">=</span> <span class="st">"Using an Autoregressive Integrated Moving Average time</span></span>
<span><span class="st">       series model (ARIMA)."</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Funding Amount (USD)"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Indicator interpretation:"</span>,</span>
<span>    <span class="st">"The **dark line** represents the historical monthly funding data used for</span></span>
<span><span class="st">    training the model. The **lighter line** extending to the right shows</span></span>
<span><span class="st">    the **future forecast**."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    </span>
<span>    <span class="st">"The **shaded areas** surrounding the forecast line represent </span></span>
<span><span class="st">    the **prediction intervals**: the **darker shade** is the 80% confidence </span></span>
<span><span class="st">    interval, and the **lighter shade** is the 95% confidence interval. </span></span>
<span><span class="st">    These areas indicate the likely range of future funding, showing the</span></span>
<span><span class="st">    uncertainty inherent in the forecast: the wider the shade, </span></span>
<span><span class="st">    the less certain the prediction."</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    <span class="st">"**Data Source**: OCHA Financial Tracking Service (FTS) API."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">unhcrthemes</span><span class="fu">::</span><span class="fu"><a href="https://unhcr-dataviz.github.io/unhcrthemes/reference/theme_unhcr.html" class="external-link">theme_unhcr</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                           axis <span class="op">=</span>  <span class="cn">FALSE</span>, </span>
<span>                           axis_title <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           legend<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_funding_forecast-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="analysis_donor_network_metrics">analysis_donor_network_metrics<a class="anchor" aria-label="anchor" href="#analysis_donor_network_metrics"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">recipient_name</span> <span class="op">&lt;-</span>  <span class="st">"United Nations High Commissioner for Refugees"</span></span>
<span><span class="va">network_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysis_donor_network_metrics.html">analysis_donor_network_metrics</a></span><span class="op">(</span><span class="va">flows</span>, <span class="va">recipient_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">network_metrics</span><span class="op">$</span><span class="va">graph</span></span>
<span></span>
<span><span class="co"># Create a data frame for nodes, including the calculated degree</span></span>
<span><span class="va">nodes_df_all</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Get the type property added in the original setup</span></span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">network_metrics</span><span class="op">$</span><span class="va">donor_metrics</span><span class="op">$</span><span class="va">donor</span>, </span>
<span>                  <span class="st">"Donor"</span>, <span class="st">"Destination"</span><span class="op">)</span>,</span>
<span>    <span class="co"># Calculate degree for sizing and labeling</span></span>
<span>    degree <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span>, v <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># --- Prepare Node Data AND Compute Coordinates </span></span>
<span><span class="co"># Create the layout object first to get the coordinates (x, y)</span></span>
<span><span class="va">layout_data</span> <span class="op">&lt;-</span> <span class="fu">ggraph</span><span class="fu">::</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">create_layout</a></span><span class="op">(</span><span class="va">g</span>,</span>
<span> layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="co"># Fruchterman-Reingold  General networks</span></span>
<span><span class="co"># layout = "circle")</span></span>
<span><span class="co"># layout = "kk")    #Kamada-Kawai   Small to medium networks </span></span>
<span><span class="co"># layout = "dr") #  Davidson-Harel  Finding a minimum-energy state; </span></span>
<span></span>
<span><span class="co"># Filter the layout data to only include the nodes of interest, </span></span>
<span><span class="co"># ensuring all necessary columns (x, y, name, type, degree) are present.</span></span>
<span><span class="va">nodes_df_all_coords</span> <span class="op">&lt;-</span> <span class="va">layout_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">nodes_df_all</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">type</span>, <span class="va">degree</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="st">"name"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="co"># Filter out any non-donor/non-destination nodes </span></span>
<span></span>
<span><span class="co"># --- Ggraph Plot ---</span></span>
<span><span class="fu">ggraph</span><span class="fu">::</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">layout_data</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Use the layout_data object here</span></span>
<span></span>
<span>  <span class="co"># EDGES: Use geom_edge_fan (works seamlessly with layout_data)</span></span>
<span>  <span class="fu">ggraph</span><span class="fu">::</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_fan.html" class="external-link">geom_edge_fan</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">weight</span><span class="op">)</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">0.3</span>, </span>
<span>                        width <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                        show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu">ggraph</span><span class="fu">::</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html" class="external-link">geom_node_point</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">nodes_df_all_coords</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">name</span>, </span>
<span>                                                    <span class="va">nodes_df_all_coords</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                              size <span class="op">=</span> <span class="va">nodes_df_all_coords</span><span class="op">$</span><span class="va">degree</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">name</span>,</span>
<span>                                                    <span class="va">nodes_df_all_coords</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                          alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># --- label ---</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">nodes_df_all_coords</span>, </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">name</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, </span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>    force <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    max.overlaps <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    box.padding <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    segment.color <span class="op">=</span> <span class="st">'grey80'</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">15</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Degree"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Donor"</span> <span class="op">=</span> <span class="st">"#007BFF"</span>,</span>
<span>                                         <span class="st">"Destination"</span> <span class="op">=</span> <span class="st">"#FFC300"</span><span class="op">)</span>, </span>
<span>                              name <span class="op">=</span> <span class="st">"Node Type"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Funding Network for "</span>, <span class="va">recipient_name</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Node size reflects Degree (number of destination)."</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Data Source: OCHA Financial Tracking Service (FTS) API. </span></span>
<span><span class="st">    Layout: Fruchterman-Reingold."</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggraph</span><span class="fu">::</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html" class="external-link">theme_graph</a></span><span class="op">(</span></span>
<span>    background <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    base_family <span class="op">=</span> <span class="st">"sans"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="4-analysis_files/figure-html/example-analysis_donor_network_metrics-1.png" class="r-plt" width="90%" style="display: block; margin: auto;"></p>
<!--
# There can be development actions

Create a chunk with 'development' actions

- The chunk needs to be named `development` or `dev`
- It contains functions that are used for package development only
- Note that you may want to store most of these functions in the 0-dev_history.Rmd file

These are only included in the present flat template file, their content will not be part of the package anywhere else.
-->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edouard Legoupil.</p>
</div>

<div class="pkgdown-footer-right">
  <p><a href="https://www.unhcr.org/" target="_blank" rel="noopener noreferrer" class="external-link"><img src="https://raw.githubusercontent.com/unhcr-dataviz/unhcrtemplate/master/man/figures/logo.svg" alt="UNHCR logo" style="max-height:2.5rem"></a></p>
</div>

    </footer>
</div>





  </body>
</html>
