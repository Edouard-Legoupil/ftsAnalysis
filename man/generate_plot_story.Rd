% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_plot_story.R
\name{generate_plot_story}
\alias{generate_plot_story}
\title{Generate Humanitarian Data Story from ggplot}
\usage{
generate_plot_story(plot, max_tokens = 30, provider = NULL, model = NULL)
}
\arguments{
\item{plot}{A \code{ggplot} object from ggplot2.}

\item{max_tokens}{Maximum number of tokens (approximate)
for the narrative (default = 30).}

\item{provider}{Optional character string specifying the provider. Options
include:
\code{"openai"}, \code{"gemini"}, \code{"anthropic"}, \code{"ollama"}. If \code{NULL},
auto-detect from environment keys.}

\item{model}{Optional character string specifying the model name. If \code{NULL},
a default model for the chosen provider will be used.}
}
\value{
A character string containing a storytelling narrative focused on
humanitarian data.
}
\description{
This function takes a ggplot2 object and generates a storytelling narrative
focused on humanitarian insights. It uses the \{ellmer\} package to call
a large language model from a supported provider.
}
\details{
The narrative can be used as a full‑text explanation or a concise subtitle
for plots. The LLM has access to the plot’s data (truncated for efficiency),
title, subtitle, and caption. Both provider and model can be chosen explicitly
or detected automatically based on which API key environment variable is set.

Setup:
\enumerate{
\item Install \{ellmer\}: \code{install.packages("ellmer")}
\item Use Ollama or Set your API key in your environment, for example:
\code{Sys.setenv(OPENAI_API_KEY = "<YOUR_OPENAI_KEY>")}
\code{Sys.setenv(GEMINI_API_KEY = "<YOUR_GOOGLE_GEMINI_KEY>")}
\code{Sys.setenv(ANTHROPIC_API_KEY = "<YOUR_ANTHROPIC_KEY>")}
}
}
\examples{

library(ggplot2)
p <- ggplot(mtcars, aes(x = wt, y = mpg)) +
   geom_point() +
    unhcrthemes::theme_unhcr(grid = "Y", axis = "X", axis_title = FALSE) +
   labs(title = "Vehicle Efficiency",
        subtitle = "Fuel consumption vs weight",
        caption = "Source: mtcars dataset")

story <- generate_plot_story(p)
cat(story)
# To use as subtitle:
p + ggplot2::labs(subtitle = story)
}
