% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/filter_flows_for_indicators.R
\name{filter_flows_for_indicators}
\alias{filter_flows_for_indicators}
\title{Filter and Normalize FTS Funding Flows for Indicator Computation}
\usage{
filter_flows_for_indicators(flows)
}
\arguments{
\item{flows}{A tibble or dataframe containing FTS funding flows, with at
minimum the following columns:
\itemize{
\item \code{boundary}: classification of flow direction relative to a search boundary
\item \code{childFlowIds}: list-column of IDs of downstream child flows
\item \code{flowType}: flow categorization ("Carryover", "Parked", "Pass through", "Standard")
\item \code{budgetYear}: year of budget attribution (character, factor, or numeric)
}}
}
\value{
A tibble of cleaned and normalized flows suitable for all donor-,
recipient-, destination-, and donor→recipient indicator functions.
The returned dataset contains only incoming, non-parent, non-parked
flows with numeric budget years.
}
\description{
This utility function applies the standard set of preprocessing and
filtering rules required when computing donor-, recipient-, or
destination-level indicators from FTS (Financial Tracking Service)
funding flow data.
}
\details{
The FTS data model contains several elements—such as funding chains,
boundaries, parent/child flows, and "parked" envelopes—that must be
normalized prior to any aggregation. This function enforces the
official FTS logic to ensure indicators are computed without
double-counting or misclassification of funding flows.

\strong{Key filtering rules applied:}
\subsection{1. Boundary Filtering}{

Only \strong{incoming} flows are retained.
Incoming flows represent funding entering a boundary (e.g., affected
country + year, appeal, donor-country-year).
This is the standard FTS method for calculating donor contributions,
and prevents contamination from:
\itemize{
\item Internal flows (money moving within the boundary)
\item Outgoing flows (money leaving the boundary)
\item Irrelevant flows (fully outside the boundary)
}

Boundary filtering ensures that only flows relevant to the selected
analytical scope enter the indicator dataset.
}

\subsection{2. Parent/Child Flow Deduplication}{

FTS allows funding flows to be "chained" to represent cascading
funding (donor → agency → partner). Parent flows are typically
high-level envelopes; child flows represent operational allocations.

This function:
\itemize{
\item Identifies parents by the presence of one or more \code{childFlowIds}.
\item Removes all parent flows from the dataset.
}

This prevents double-counting parent envelopes together with their
child breakdowns and ensures only operational flows are used in
indicator calculations.
}

\subsection{3. Removal of "Parked" Flows}{

Flows with \code{flowType == "Parked"} represent undecided envelopes
awaiting breakdown into child flows (e.g., large ECHO decisions or
multi-year envelopes).

These should not be used for:
\itemize{
\item donor funding totals
\item donor–recipient relationships
\item sector or geographic alignment indicators
}

The function removes them entirely, relying instead on their child
flows when available.
}

\subsection{4. Budget Year Normalization}{

The \code{budgetYear} column is converted safely to numeric to support
time-series indicators such as:
\itemize{
\item funding trends
\item relationship duration
\item consistency indices
}

Non-numeric and malformed values are converted to \code{NA} with warnings
suppressed.
}
}
\section{Warning}{

This function removes parent flows and parked envelopes by design.
If users require indicators specifically about envelope-level
commitments, they should apply a custom filter before calling this
function.
}

\examples{
#cleaned <- filter_flows_for_indicators(flows)
}
