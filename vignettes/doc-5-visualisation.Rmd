---
title: "Doc-5-Visualisation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Doc-5-Visualisation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(ftsAnalysis)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/flat_dev_5_visualisation.Rmd: do not edit by hand -->




# Using Language Models to build data stories

## clean_llm_response
  
```{r example-clean_llm_response}
response <- "<think>
First, I'm a humanitarian data visualization expert. My role includes extracting insights 
from visualizations, creating accessible narratives, highlighting patterns relevant to aid
efforts, using clear language with emotional resonance.
Aligning with constraints: Use plain language, be concise and impactful. Don't rehash 
every detail; build narrative depth around 2 key insights maximum in under 30 tokens.
</think>
This visualization tracks a relationship potentially critical for humanitarian logistics: 
higher fuel consumption versus increased weight. 车辆设计"
clean_llm_response(response)
```

  
  

## generate_plot_story
  
```{r example-generate_plot_story}

library(ggplot2)
p <- ggplot(mtcars, aes(x = wt, y = mpg)) +
   geom_point() +
    unhcrthemes::theme_unhcr(grid = "Y", axis = "X", axis_title = FALSE) +
   labs(title = "Vehicle Efficiency",
        subtitle = "Fuel consumption vs weight",
        caption = "Source: mtcars dataset")

generate_plot_story(p, provider = "ollama", model = "deepseek-r1")

story <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini", max_tokens = 300)
# To use as subtitle:
p + ggplot2::labs(subtitle = story)
```

  

# Donor Plots
## plot_donor_funding_over_time
  
```{r example-plot_donor_funding_over_time}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_donor_funding_over_time(flows, donor_name= "Spain, Government of")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
print(p + ggplot2::labs(subtitle = dubbed))

```



## plot_donor_earmarking
  
```{r example-plot_donor_earmarking}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_donor_earmarking(flows, donor_name= "Spain, Government of")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```

  
  


## plot_donor_flowtype
  
```{r example-plot_donor_flowtype}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_donor_flowtype(flows, donor_name= "Spain, Government of")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```




## plot_donor_cluster_coverage
  
```{r example-plot_donor_cluster_coverage}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_donor_cluster_coverage(flows, donor_name= "Spain, Government of")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```



# Recipient Plot

## plot_recipient_funding_composition
  
```{r example-plot_recipient_funding_composition}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_recipient_funding_composition(flows, 
              recipient_name = "United Nations High Commissioner for Refugees")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```



## plot_recipient_grandbargain
  
```{r example-plot_recipient_grandbargain}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_recipient_grandbargain(flows,
          recipient_name = "United Nations High Commissioner for Refugees")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```


  
## plot_recipient_cofunding
  
```{r example-plot_recipient_cofunding}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_recipient_cofunding(flows, 
              recipient_name = "United Nations High Commissioner for Refugees")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```



## plot_recipient_contribution_type
  
```{r example-plot_recipient_contribution_type}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_recipient_contribution_type(flows, 
                recipient_name = "United Nations High Commissioner for Refugees")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```



# Destination Plot

## plot_destination_funding_destination
  
```{r example-plot_destination_funding_destination}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_destination_funding_destination(flows, destination_name= "Burundi")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```



## plot_destination_funding_donor
  
```{r example-plot_destination_funding_donor}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_destination_funding_donor(flows, destination_name= "Burundi")
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```



## plot_destination_heatmap
  
```{r example-plot_destination_heatmap}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_destination_heatmap(flows, destination_name= "Burundi", top_n = 5)
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```




# Global Plot

## plot_funding_status_timeline
  
```{r example-plot_funding_status_timeline}
#| fig.retina: 2.0
#| fig.width: 8.0
#| fig.asp: 0.618
#| fig.align: center
#| out.width: 90%

p <- plot_funding_status_timeline(flows)
# and plot with more powerful subtitle
dubbed <- generate_plot_story(p, provider = "azure", model = "gpt-4.1-mini")
p + ggplot2::labs(subtitle = dubbed)
```






